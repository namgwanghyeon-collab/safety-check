<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>안전장비 검교정 현황</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 로드 (Tailwind 기본 폰트) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* 모달 배경을 어둡게 처리 */
        #editModalBackdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* 테이블 행에 마우스 올렸을 때 스타일 */
        .data-row:hover {
            background-color: #f9fafb; /* 매우 연한 회색 */
            cursor: pointer;
        }
        /* ★★★ 정렬 기능용 스타일 ★★★ */
        /* 정렬 가능한 헤더 스타일 */
        th.sortable-header {
            cursor: pointer;
            user-select: none; /* 텍스트 드래그 방지 */
            position: relative;
        }
        th.sortable-header:hover {
            background-color: #e5e7eb; /* 연한 회색 */
        }
        /* 정렬 화살표 */
        .sort-indicator {
            display: inline-block;
            width: 1em; /* 너비 고정 */
            margin-left: 6px;
            color: #9ca3af; /* 회색 */
            font-size: 0.65rem; /* 아이콘 크기 */
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8">
        
        <!-- 페이지 제목 -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center text-gray-800">
                안전장비 검교정 현황
            </h1>
        </header>

        <!-- 버튼 영역 -->
        <div class="mb-4 flex justify-end">
            <button id="addRowBtn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                + 신규 장비 추가
            </button>
        </div>

        <!-- 메인 컨텐츠: 현황판 카드 -->
        <main class="bg-white rounded-lg shadow-xl overflow-hidden">
            
            <!-- 모바일 화면을 위한 가로 스크롤 래퍼 -->
            <div class="overflow-x-auto">
                
                <!-- 현황 테이블 -->
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <!-- ★★★ 'No' 열 추가 (정렬 기능 없음) ★★★ -->
                            <th scope="col" class="w-16 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                No
                            </th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                장비번호<span class="sort-indicator"></span>
                            </th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                자산번호<span class="sort-indicator"></span>
                            </th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                검교정 상태<span class="sort-indicator"></span>
                            </th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                최근 검교정일<span class="sort-indicator"></span>
                            </th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                차기 검교정일<span class="sort-indicator"></span>
                            </th>
                            <!-- ★★★ '담당자' 열 class= 오타 수정 ★★★ -->
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                담당자<span class="sort-indicator"></span>
                            </th>
                            <!-- '관리' 열은 정렬에서 제외 -->
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                관리
                            </th>
                        </tr>
                    </thead>
                    <!-- ID 'equipmentTableBody' -->
                    <tbody id="equipmentTableBody" class="bg-white divide-y divide-gray-200">
                        
                        <!-- 예시 데이터 1: 'No' 열 <td> 추가 -->
                        <tr class="data-row">
                            <!-- ★★★ 'No' <td> 추가 ★★★ -->
                            <td class="row-number-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">가스 감지기</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">SAF-GAS-001</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">ASSET-1001</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm status-cell">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">정상</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2025-10-01</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2026-04-01</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">홍길동</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                <button class="delete-btn text-red-600 hover:text-red-900">삭제</button>
                            </td>
                        <!-- 예시 데이터 2: 'No' 열 <td> 추가 -->
                        <tr class="data-row">
                            <!-- ★★★ 'No' <td> 추가 ★★★ -->
                            <td class="row-number-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">소음 측정기</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">SAF-SND-002</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">ASSET-1002</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm status-cell">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">보정 필요</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2025-05-15</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2025-11-15</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">이순신</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                <button class="delete-btn text-red-600 hover:text-red-900">삭제</button>
                            </td>
                        <!-- 예시 데이터 3: 'No' 열 <td> 추가 -->
                        <tr class="data-row">
                            <!-- ★★★ 'No' <td> 추가 ★★★ -->
                            <td class="row-number-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">전기 절연 장갑</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">SAF-EGV-003</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">ASSET-1003</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm status-cell">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">사용 불가 (폐기)</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2024-03-01</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2024-09-01</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">김유신</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                <button class="delete-btn text-red-600 hover:text-red-900">삭제</button>
                            </td>
                        <!-- 예시 데이터 4: 'No' 열 <td> 추가 -->
                        <tr class="data-row">
                            <!-- ★★★ 'No' <td> 추가 ★★★ -->
                            <td class="row-number-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">안전모 (특급)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">SAF-HMT-004</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">ASSET-1004</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm status-cell">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">정상</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2025-09-20</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2026-09-20</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">홍길동</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                <button class="delete-btn text-red-600 hover:text-red-900">삭제</button>
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>

        </main>

        <!-- 참고 메시지 -->
        <div class="mt-4 p-4 bg-yellow-100 text-yellow-800 rounded-lg text-center">
            <p><strong class="font-semibold">참고:</strong> 현재 페이지에서 수정/추가/삭제한 내용은 임시이며, 페이지를 새로고침하면 사라집니다.</p>
        </div>

        <!-- 푸터 -->
        <footer class="text-center text-gray-500 text-sm mt-8">
            © 2025 [귀사명 입력]. All rights reserved.
        </footer>

    </div>

    <!-- ★★★ 편집 모달 (팝업창) ★★★ -->
    <div id="editModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <!-- 모달 배경 -->
        <div id="editModalBackdrop" class="fixed inset-0"></div>
        
        <!-- 모달 컨텐츠 -->
        <div class="relative bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 p-6">
            <h2 class="text-xl font-bold mb-4">장비 정보 수정</h2>
            
            <!-- 편집 폼 -->
            <form id="editForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="editName" class="block text-sm font-medium text-gray-700">장비명</label>
                        <input type="text" id="editName" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                    <div>
                        <label for="editNumber" class="block text-sm font-medium text-gray-700">장비번호</label>
                        <input type="text" id="editNumber" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                    <div>
                        <label for="editAsset" class="block text-sm font-medium text-gray-700">자산번호</label>
                        <input type="text" id="editAsset" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                    <div>
                        <label for="editStatus" class="block text-sm font-medium text-gray-700">검교정 상태</label>
                        <input type="text" id="editStatus" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="예: 정상, 보정 필요">
                    </div>
                    <div>
                        <label for="editLastDate" class="block text-sm font-medium text-gray-700">최근 검교정일</label>
                        <input type="text" id="editLastDate" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="YYYY-MM-DD">
                    </div>
                    <div>
                        <label for="editNextDate" class="block text-sm font-medium text-gray-700">차기 검교정일</label>
                        <input type="text" id="editNextDate" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="YYYY-MM-DD">
                    </div>
                    <div class="md:col-span-2">
                        <label for="editManager" class="block text-sm font-medium text-gray-700">담당자</label>
                        <input type="text" id="editManager" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                </div>

                <!-- 버튼 영역 -->
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="closeModalBtn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">
                        닫기
                    </button>
                    <button type="submit" id="saveModalBtn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ★★★ JavaScript 로직 ★★★ -->
    <script>
        const tableBody = document.getElementById('equipmentTableBody');
        const addRowBtn = document.getElementById('addRowBtn');
        const editModal = document.getElementById('editModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const editModalBackdrop = document.getElementById('editModalBackdrop');
        const editForm = document.getElementById('editForm');

        let currentRow = null; // 현재 편집 중인 행(TR)을 저장할 변수

        // ★★★ 신규 기능: 'No' 열 번호 자동 갱신 함수 ★★★
        function updateRowNumbers() {
            const rows = tableBody.querySelectorAll('tr.data-row');
            rows.forEach((row, index) => {
                // 첫 번째 <td> (No 열)을 찾아서 텍스트를 업데이트
                const cell = row.querySelector('.row-number-cell');
                if (cell) {
                    cell.innerText = index + 1;
                }
            });
        }
        // ★★★ 'No' 갱신 함수 끝 ★★★


        // ★★★ 신규 기능: 테이블 정렬 ★★★
        document.querySelectorAll('th.sortable-header').forEach(header => {
            header.addEventListener('click', () => {
                const table = header.closest('table');
                const tbody = table.querySelector('tbody');
                // 클릭된 헤더의 열 인덱스(0, 1, 2...)를 찾습니다.
                const columnIndex = Array.from(header.parentNode.children).indexOf(header);
                // 현재 정렬 방향을 읽어오거나 'desc'로 기본 설정 (다음에 'asc'가 되도록)
                const currentDirection = header.dataset.sortDirection || 'desc';
                const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';

                // 1. 모든 헤더의 정렬 방향 초기화 및 화살표 제거
                document.querySelectorAll('th.sortable-header').forEach(h => {
                    h.dataset.sortDirection = 'desc'; // 다른 헤더는 초기화
                    h.querySelector('.sort-indicator').textContent = ''; // 다른 화살표 제거
                });

                // 2. 현재 클릭된 헤더의 방향 설정 및 화살표 표시
                header.dataset.sortDirection = newDirection;
                header.querySelector('.sort-indicator').textContent = newDirection === 'asc' ? '▲' : '▼'; // 오름차순/내림차순 표시

                // 3. 테이블 행 정렬
                const rows = Array.from(tbody.querySelectorAll('tr.data-row'));
                rows.sort((rowA, rowB) => {
                    // 각 행의 해당 열(columnIndex)에 있는 셀(TD)의 텍스트를 가져옵니다.
                    const cellA = rowA.querySelectorAll('td')[columnIndex].innerText.toLowerCase();
                    const cellB = rowB.querySelectorAll('td')[columnIndex].innerText.toLowerCase();

                    // 텍스트 비교
                    if (cellA < cellB) {
                        return newDirection === 'asc' ? -1 : 1;
                    }
                    if (cellA > cellB) {
                        return newDirection === 'asc' ? 1 : -1;
                    }
                    return 0; // 같으면 순서 변경 없음
                });

                // 4. 정렬된 행을 다시 tbody에 순서대로 추가
                // (appendChild는 기존 요소를 이동시킵니다)
                rows.forEach(row => tbody.appendChild(row));

                // ★★★ 정렬 후 'No' 열 갱신 ★★★
                updateRowNumbers();
            });
        });
        // ★★★ 정렬 기능 끝 ★★★

        // 상태 텍스트에 따라 올바른 HTML <span>을 반환하는 함수
        function getStatusSpan(statusText) {
            statusText = statusText.trim();
            if (statusText.includes("정상")) {
                return `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${statusText}</span>`;
            } else if (statusText.includes("보정 필요")) {
                return `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">${statusText}</span>`;
            } else if (statusText.includes("사용 불가")) {
                return `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">${statusText}</span>`;
            } else { // 기본 (신규 등)
                return `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">${statusText}</span>`;
            }
        }

        // 모달 열기 함수
        function openModal(row) {
            currentRow = row; // 현재 행 저장
            const cells = row.getElementsByTagName('td');
            
            // ★★★ 'No' 열이 추가(cells[0])되어 인덱스 +1 씩 수정 ★★★
            // 폼에 현재 데이터 채우기
            document.getElementById('editName').value = cells[1].innerText;
            document.getElementById('editNumber').value = cells[2].innerText;
            document.getElementById('editAsset').value = cells[3].innerText;
            document.getElementById('editStatus').value = cells[4].innerText; // span 안의 텍스트
            document.getElementById('editLastDate').value = cells[5].innerText;
            document.getElementById('editNextDate').value = cells[6].innerText;
            document.getElementById('editManager').value = cells[7].innerText;

            editModal.classList.remove('hidden'); // 모달 보이기
        }

        // 모달 닫기 함수
        function closeModal() {
            editModal.classList.add('hidden'); // 모달 숨기기
            currentRow = null; // 현재 행 초기화
        }

        // '신규 장비 추가' 버튼 클릭 이벤트
        addRowBtn.addEventListener('click', function() {
            const newRowHTML = `
                <tr class="data-row">
                    <!-- ★★★ 'No' <td> 추가 ★★★ -->
                    <td class="row-number-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">(장비명 입력)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">(장비번호 입력)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">(자산번호 입력)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm status-cell">
                        ${getStatusSpan('신규')}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">(YYYY-MM-DD)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">(YYYY-MM-DD)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">(담당자 입력)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                        <button class="delete-btn text-red-600 hover:text-red-900">삭제</button>
                    </td>
                </tr>
            `;
            tableBody.insertAdjacentHTML('beforeend', newRowHTML);

            // ★★★ 행 추가 후 'No' 열 갱신 ★★★
            updateRowNumbers();
        });

        // 테이블 영역 클릭 이벤트 (이벤트 위임)
        tableBody.addEventListener('click', function(e) {
            // '삭제' 버튼을 클릭한 경우
            if (e.target.classList.contents('delete-btn')) {
                const row = e.target.closest('tr'); // 클릭한 버튼이 속한 행(TR)
                row.remove(); // 행 삭제
                
                // ★★★ 행 삭제 후 'No' 열 갱신 ★★★
                updateRowNumbers();

                return; // 모달이 열리지 않도록 여기서 중단
            }

            // 'data-row' 클래스를 가진 행(TR)을 클릭한 경우
            const row = e.target.closest('.data-row');
            if (row) {
                openModal(row);
            }
        });

        // 모달 '닫기' 버튼
        closeModalBtn.addEventListener('click', closeModal);
        // 모달 '배경' 클릭 시 닫기
        editModalBackdrop.addEventListener('click', closeModal);

        // 모달 '저장' 버튼 클릭 이벤트 (폼 제출)
        editForm.addEventListener('submit', function(e) {
            e.preventDefault(); // 폼의 기본 제출 동작(새로고침) 방지

            if (currentRow) {
                const cells = currentRow.getElementsByTagName('td');
                
                // ★★★ 'No' 열이 추가(cells[0])되어 인덱스 +1 씩 수정 ★★★
                // 폼의 새 데이터로 테이블 셀(TD) 내용 업데이트
                cells[1].innerText = document.getElementById('editName').value;
                cells[2].innerText = document.getElementById('editNumber').value;
                cells[3].innerText = document.getElementById('editAsset').value;
                // 상태 셀은 스타일(span)을 다시 생성
                cells[4].innerHTML = getStatusSpan(document.getElementById('editStatus').value);
                cells[5].innerText = document.getElementById('editLastDate').value;
                cells[6].innerText = document.getElementById('editNextDate').value;
                cells[7].innerText = document.getElementById('editManager').value;

                closeModal(); // 모달 닫기
            }
        });

        // ★★★ 페이지 로드 시 'No' 열 초기화 ★★★
        document.addEventListener('DOMContentLoaded', updateRowNumbers);
    </script>

</body>
</html>

